# ARCHITECTURE-GUIDELINES.md (Claude-ready)

> Doel: deze regels zorgen dat het project **snel**, **leesbaar**, **veilig** en **schaalbaar** blijft.  
> Deze guidelines zijn geschreven voor een vibecoding workflow (AI-assisted development), dus: **expliciet**, **modulair**, **veel commentaar**, **geen spaghetti**.

---

## 1) Core principes
### 1. Simplicity first
- Kies leesbaarheid boven “slimme” abstractions
- Favor explicit over implicit
- Maak het onderhoudbaar voor jezelf + AI

### 2. Modularity
- Eén verantwoordelijkheid per module/file
- Feature-based organisatie
- Duidelijke grenzen tussen features

### 3. Documentatie
- Elke file start met een header comment (zie §3)
- Niet-triviale logica krijgt inline comments
- Liever te veel context dan te weinig

---

## 2) Hard rules (enforced)
### File size limits
- **Target:** < 300 regels per file
- **Warning:** 300–500 (refactor aanbevolen)
- **Error:** > 500 (moet gesplitst)

> Regels tellen: comments + whitespace mee.  
> Uitzondering: type-only `.d.ts` of autogenerated.

### Folder structuur (feature-first)
Elke feature volgt:

```
/features/<featureName>/
  types/
  utils/
  hooks/
  components/
  <FeatureName>Page.tsx
  index.ts
```

**Rules**
- `types/`: alleen types/interfaces
- `utils/`: pure functions (geen side effects)
- `hooks/`: data fetching / state / business logic
- `components/`: presentational UI

### Import discipline
Standaard volgorde:
1) React / Next
2) Third-party libs
3) Internal libs (`/lib/*`)
4) Feature hooks/utils
5) Feature components
6) Types (type-only imports)

### Exports
- Named exports preferred
- Default export alleen voor pages/route components
- Vermijd `export * from` (maakt dependencies onduidelijk)

---

## 3) File header standaard (verplicht)
Elke file begint met:

```ts
/**
 * path/to/file.tsx
 *
 * Wat doet deze file? (1–2 zinnen)
 *
 * Waarom bestaat dit? Welke verantwoordelijkheid?
 *
 * Related:
 * - path/to/related-1.ts
 * - path/to/related-2.tsx
 */
```

---

## 4) UI component regels
- Eén component per file
- Props interface bovenaan
- Minimal logic in component (delegatie naar hooks/utils)
- A11y: labels, aria, keyboard focus
- Touch targets ≥ 44px

Wanneer splitsen?
- > 250 regels
- meerdere verantwoordelijkheden
- complexe conditionals
- herbruikbaar blok herkenbaar

---

## 5) Hooks regels
- Eén hook per file
- `use*` naming
- Side effects geïsoleerd
- Error handling standaard (try/catch + user feedback)
- Max 200 regels per hook

---

## 6) Utils regels
- Pure functions only
- Geen DOM/React imports
- Goed gedocumenteerd (JSDoc)
- Max 250 regels per util file

---

## 7) Access control & security rules
- Private data: altijd server-side checks (Payload access + server enforcement)
- No “public write” endpoints behalve forms (rate limited)
- Markdown sanitize before render
- Admin routes behind role checks
- Stripe webhooks idempotent

---

## 8) Testing (minimaal maar effectief)
- Unit tests voor utils
- Component tests voor kritische UI
- Smoke tests voor routing + forms

Naming:
- `X.ts` → `X.test.ts`
- `X.tsx` → `X.test.tsx`

---

## 9) Performance hygiene
- RSC default (client only when needed)
- Code-split by route
- Images: AVIF/WebP, lazy, responsive sizes
- Avoid heavy dependencies
- Debounce filters/search

---

## 10) Code review checklist
- [ ] File < 300 regels (of reden + plan)
- [ ] Header comment aanwezig
- [ ] Single responsibility
- [ ] Access rules correct
- [ ] Error handling aanwezig
- [ ] Tests toegevoegd waar nodig
- [ ] i18n keys gebruikt (geen hardcoded strings buiten copy modules)
